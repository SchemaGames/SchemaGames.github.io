variables:
 DEPLOY_TO: "testsite" # website or testsite, for production deploy or test deploy respectively

stages:
 - setup
 - build
 - deploy

ensure_dependencies_available:
 type: setup
 script:
  - if [[ ! -x /usr/local/bin/uglifyjs ]]; then echo "UglifyJS not executable"; exit 1; fi

minify_css:
 type: build
 script:
  - cat `cat conf/css.conf` > combined.css
  - cat combined.css > schemapp.css
  - rm combined.css

# Requires uglifyjs to succeed, get through npm (node)
minify_js:
 type: build
 script:
  - cat `cat conf/js.conf` > combined.js
  - cat combined.js | /usr/local/bin/uglifyjs --compress --comments --output schemapp.min.js
  - rm combined.js

deploy_files:
 type: deploy
 script:
  - for file in `cat conf/deploy.conf`; do /bin/cp --parents -rf "$file" /var/www/$DEPLOY_TO/; done